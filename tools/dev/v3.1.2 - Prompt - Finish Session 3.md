# Role
You are a highly methodical Senior Software Engineer, with passion for finishing tasks completely and being extremely attentive to details - consistenly making sure nothing is missing and nothing is wrong.

# Goal 
Finish implementation of Architecture 3.1. Particularly in this implementation session, make a few corrections and adjustments and completely finish the implementation of the CLI tool and its tests. Start by reading all of the documents in the Context section below; then read all of Tasks in this document, before executing them.

# Context   

## Core Project Knowledge  
Read again cloud/tools/docs/Multi_Stack_Architecture.3.1.md
Read again cloud/tools/docs/Directory_Structure_Diagram.3.1.md
Read again cloud/tools/docs/Deployment_Manifest_Specification.3.1.md
Read again cloud/tools/docs/Stack_Parameters_and_Registration_Guide.md

## Project Apps Context 
Read again cloud/tools/docs/CLI_Commands_Reference.3.1.md
Read again cloud/tools/docs/CLI_Testing_Guide.3.1.md
Read again cloud/tools/docs/CLI_Commands_Quick_Reference.3.1.md

## Session Management
Read cloud/.claude/memory/Session-3.1.md again.
Read cloud/.claude/memory/Session-3-Completion-Summary.md

## Self-Verification 
Read cloud/.claude/memory/Session-3-Failure-Analysis-And-Commitments.md
Read cloud/.claude/memory/SELF-VERIFICATION-PROTOCOL.md

# Tasks

## Task 1

    According to cloud/.claude/memory/Session-3.1.md, lines 528-549, we were supposed to have the following structure:

    <snippet>
        **Recommended Structure:**

        cloud/tools/
        ├── core/                    # Shared business logic library
        │   ├── orchestrator/
        │   ├── templates/
        │   ├── deployment/
        │   ├── runtime/
        │   ├── pulumi/
        │   ├── validation/
        │   └── utils/
        ├── cli/                     # CLI-specific (thin wrapper)
        │   ├── src/cloud_cli/
        │   │   ├── commands/        # Typer commands → call core
        │   │   └── cli_main.py
        │   └── tests/
        └── api/                     # API-specific (thin wrapper)
            ├── src/cloud_api/
            │   ├── routes/          # FastAPI routes → call core
            │   └── api_main.py
            └── tests/
    </snippet>

    ### Task 1.1 - There is no cloud/tools/core and its subdirectories, as planned, from lines 528-549. 

        - Plan a fix for this issue and execute the plan, ensuring the implementation of the Code Sharing Architecture, per line 507 and beyond.

    ### Task 1.2 - Duplication of subdirectories under cloud/tools/cli/src and cloud/tools/cli/src/cloud_cli.

        - Subdirectories: [commands, deplyment, orchestrator, runtime, templates, utils, validation]

        - Plan a fix for this issue and execute the plan, ensuring the implementation of the Code Sharing Architecture, per line 507 and beyond.

    ### Task 1.3 - In addition to correcting the issues above, think, pre-empt any possible side effects, and proactively adjust any code, or correct any related documents,if necessary. 

## Task 2

    ### Task 2.1 - Be very aware of what you did not finish on Sessions 3 and needs to be implemented now.

        <PARTIAL_list_of_uncompleted_tasks>
            **Missing Commands:** Several commands from spec not yet implemented:
            - `cloud destroy`
            - `cloud rollback`
            - `cloud deploy-stack`
            - `cloud destroy-stack`
            - Stack management commands
            - Template management commands
            - Additional validation commands

            - Unit tests for all new modules (orchestrator, templates, deployment, runtime, Pulumi)
            - Integration tests for CLI commands
            - Mock Pulumi CLI for testing
            - Mock AWS for testing
            - Achieve 90%+ code coverage
        </PARTIAL_list_of_uncompleted_tasks>

        IMPORTANT: There might be more unfinished, CLI-related items, to be completed; than shown in the list above. Consult the Session 3 documents, as well as documentation related to the CLI.

    ### Task 2.2 - Understand once and for all the separation of implementation sessions 
    
        - Session 4 is exclusively for REST API!!

    ### Task 2.3 - Finish the whole CLI tool, along with its complete testing, as initially intended and described in Session 3 and other related documents

        - Make sure the partial list in Tasks 3.1 is fully completed. And any other missing items that are not on the list.

    ### Task 2.4 - Stack Registration

        - While implementing the CLI commands related to stack registration and stack management, DO IMPLEMENT according to the plan described in detail in the Stack_Parameters_and_Registration_Guide.md document.
        - Make sure the CLI tool can handle all aspects of stack registration, parameter management, and stack discovery as described in the document.  
        - Think about possible adjustments to code that has been implemented already. Plan and execute these adjustments.

## Task 3 - Finish Completely - Including Passing All Tests

    - Below is a (potentially partial) Checklist (From Session-3.1.md document, lines 612-646); to help guide your work to completenedness.

    <snippet>
        ## Session Execution Checklist

        ### Pre-Execution
        - [ ] Verify Session 2.1 completion
        - [ ] Verify all 16 stacks built successfully
        - [ ] Verify CLI framework exists
        - [ ] Read Architecture 3.1 document
provide me her
        ### Phase 1: Core Business Logic
        - [ ] Implement orchestrator engine
        - [ ] Implement template management
        - [ ] Implement deployment manager
        - [ ] Implement runtime resolver
        - [ ] Implement Pulumi wrapper
        - [ ] Complete all validators

        ### Phase 2: CLI Commands
        - [ ] Implement 6 deployment lifecycle commands
        - [ ] Implement 3 environment commands
        - [ ] Implement 5 stack management commands
        - [ ] Implement 5 template commands
        - [ ] Implement 6 validation/monitoring commands

        ### Phase 3: Testing
        - [ ] Write 40+ unit tests
        - [ ] Write 10+ integration tests
        - [ ] All tests passing
        - [ ] Test full deployment workflow

        ### Phase 4: Verification
        - [ ] CLI can initialize deployment
        - [ ] CLI can deploy all stacks
        - [ ] CLI can destroy deployment
        - [ ] CLI handles errors gracefully
        - [ ] All commands documented
    </snippet>

